<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="" />
<meta name="author" content="" />

<title>Theme Template for Bootstrap</title>

<!-- Bootstrap core CSS -->

<link href="../static/css/bootstrap.min.css"
	th:href="@{/css/bootstrap.min.css}" rel="stylesheet" media="screen" />


<!-- Bootstrap theme -->

<link href="../static/css/bootstrap.min.css"
	th:href="@{/css/bootstrap-theme.min.css}" rel="stylesheet"
	media="screen" />

<!-- Custom styles for this template -->


<link href="../static/css/theme.css" th:href="@{/css/theme.css}"
	rel="stylesheet" media="screen" />
<style type="text/css">
form {
	margin: 20px 0;
}

form input, button {
	padding: 5px;
}

table {
	width: 100%;
	margin-bottom: 20px;
	border-collapse: collapse;
}

table, th, td {
	border: 1px solid #cdcdcd;
}

table th, table td {
	padding: 10px;
	text-align: left;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">
//map has been used as associative array to store object
	var dataMap = {}
	$(document).ready(function() {
		$(".add-row").click(function() {
						var quantity = $("#quantity").val();
						var sku = $("#sku").val();
							dataMap[sku] = {
											"quantity" : quantity,
											 "sku" : sku
											}
												var markup = "<tr><td><input type='checkbox' name='record'></td><td>"
														+ quantity
														+ "</td><td>"
														+ sku + "</td></tr>";
												$("table tbody").append(markup);
											});

						// Find and remove selected table rows
				        $(".delete-row").click(function(){
				            $("table tbody").find('input[name="record"]').each(function(){
				            	if($(this).is(":checked")){
				                   console.log("delete item name:" + $(this).val())
				                   // delete dataMap $(this).value
				                    $(this).parents("tr").remove();
				                }
				            });
				        });
						
						// save
						$(".save-data").click(function() {
							var arr = [];
							var i = 0;
							for ( var sku in dataMap) {
								var value = dataMap[sku];
								arr[i]=value;
								i++;
							}
							var saleList = JSON.stringify(arr);
							dataMap={}
							
							console.log(saleList +"  ---------------");
							
							
	/* 
						   var url = "http://localhost:8070/sale/sale/addsale";
							
						   $.ajax({
					            url: url,
					            type: 'post',
					            contentType: 'application/json',
					            success: function (data) {
					              alert("success");
					              $('#quantity').val("");
					              $('#sku').val("");
					              $("#saleListTableId tbody").empty();
					            },
					            error: function(status){
					            	alert("fail")
					            },
					            data: saleList
					        }); */
						   
							 $('#saleListId').val(saleList);
							 $( "#saleFormId" ).submit();
		
	
			   });
});
</script>

</head>

<body>

	<!-- Fixed navbar -->

	<div class="container">

		<form th:action="@{/testSale/saveSale}" method="post" autocomplete="off"
			style="max-width: 250px" id="saleFormId">
			<div class="form-group">
				<h4>Enter Sale Details</h4>
				<br />

			</div>

			<div class="form-group">
			<input type="text" id="sku" placeholder="SKU" /> 
				<input type="text" id="quantity" placeholder="Quantity" /> 
				
					<input type="button" class="add-row" value="Add Row" />
			</div>
			<div>
			<input type="hidden" id="saleListId"  name="saleList" placeholder="saleList" /> 
			</div>

			<div>
				<table id="saleListTableId">
					<thead>
						<tr>
							<th>Select</th>
							<th>Quantity</th>
							<th>SKU</th>
						</tr>
					</thead>
					<tbody>
						
					</tbody>
				</table>

			</div>

			<button type="button" class="delete-row">Delete Row</button>
			<button type="button" class="save-data">Save</button>


			<a class="btn  btn-default" th:href="@{/}">Cancel</a> <br />

		</form>
	</div>
	<!-- /container -->

	<!-- Bootstrap core JavaScript
    ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

	<script src="../static/js/bootstrap.min.js"
		th:src="@{/js/bootstrap.min.js}"></script>
</body>
</html>